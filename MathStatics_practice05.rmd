---
title: "第5次实践 方差分析"
author: "feammer"
output: html_document
---

## 实验目的

1. 掌握单因素方差分析原理.

2. 理解单因素方差分析的前提条件.

3. 掌握双因素方差分析原理.

4. 理解双因素方差分析的前提条件.


## 实验要求

1. 熟练掌握R中方差分析的相关命令.

2. 会对方差分析模型作参数检验和模型评价.

## 实验内容

> 生成因子水平`gl(n, k, length= n*k, labels = 1:n, ordered = FALSE)`  
> `n`是因子的水平个数;  
> `k`表示每一水平上重复的次数;  
> `length`表示数据总长度,$n\cdot k < length$时对因子轮询标记水平;  
> `labels`对因子的不同水平添加标签;  
> `ordered`为逻辑值,指示是否排序

```{r message=FALSE}
library(car)
library(gplots)
```

### 实验1

设有三台机器,用来生产规格相同的铝合金薄板.取样,测量薄板的厚度精确至千分之一厘米,得结果如下表所示：

$$
\begin{array}{|r|r|r|r|}
\hline \text { 观测编号 } & \text { 机器1 } & \text { 机器2 } & {\text { 机器3 }} \\
\hline 1 & 0.236 & 0.257 & 0.258 \\
\hline 2 & 0.238 & 0.253 & 0.264 \\
\hline 3 & 0.248 & 0.255 & 0.259 \\
\hline 4 & 0.245 & 0.254 & 0.267 \\
\hline 5 & 0.243 & 0.261 & 0.262 \\
\hline
\end{array}
$$

假设本题符合单因素方差分析模型的条件,检验3台机器生产的薄板的厚度有无显著差异.

```{r}
x <- c(
    0.236, 0.238, 0.248, 0.245, 0.243,
    0.257, 0.253, 0.255, 0.254, 0.261,
    0.258, 0.264, 0.259, 0.267, 0.262
)
# 用gl函数生成因子
A <- gl(3, 5)
fit <- aov(x ~ A)
summary(fit)

# 进行多重比较
pairwise.t.test(x, A)
boxplot(x ~ A)

# 正态检验
shapiro.test(x)
shapiro.test(x[1:5])
shapiro.test(x[6:10])
shapiro.test(x[11:15])

# 方差齐性检验
bartlett.test(x ~ A)
# 方差齐性分析对离群点非常敏感
outlierTest(fit)

plotmeans(x ~ A, xlab = "机器", ylab = "薄板厚度", main = "Mean Plot\nwith 95%CI")
```

### 实验2

为了对几个行业的服务质量进行评价,消费者协会在4个行业分别抽取了不同的企业作为样本.最近一年中消费者对总共23家企业投诉的次数如下表所示：

$$
\begin{array}{|r|r|r|r|r|}
\hline \text { 观测编号 } & \text { 零售业 } & \text { 旅游业 } & \text { 航空公司 } & \text { 家电制造业 }\\
\hline 1 & 57 & 68 & 31 & 44 \\
\hline 2 & 66 & 39 & 49 & 51 \\
\hline 3 & 49 & 29 & 21 & 65 \\
\hline 4 & 40 & 45 & 34 & 77 \\
\hline 5 & 34 & 56 & 40 & 58 \\
\hline 6 & 53 & 51 & & \\
\hline 7 & 44 & & & \\
\hline
\end{array}
$$

假设本题符合单因素方差分析模型的条件,检验4个行业对投诉次数有无显著影响($\alpha=0.05$).

```{r}
x <- c(
    57, 66, 49, 40, 34, 53, 44,
    68, 39, 29, 45, 56, 51,
    31, 49, 21, 34, 40,
    44, 51, 65, 77, 58
)
# 用factor函数生成因子
A <- factor(c(rep(1, 7), rep(2, 6), rep(3, 5), rep(4, 5)))
fit <- aov(x ~ A)
summary(fit)
# 进行多重比较
pairwise.t.test(x, A)
plotmeans(x ~ A, xlab = "x", ylab = "A", p = 0.95, main = "mean plot\nwith 95% CI")
boxplot(x ~ A)
```

### 实验3

一火箭用四种燃料,三种推进器作射程试验.每一种燃料与每种推进器的组合各发射火箭两次,得射程如下所示(以海里计)

$$
\begin{array}{|r|r|r|r|}
\hline 燃料 & 推进器B1 & 推进器B2 & 推进器B3 \\
\hline A_1 & 58.2  &  56.2  &  65.3  \\
           & 52.6  &  41.2  &  60.8  \\
\hline A_2 & 49.1  &  54.1  &  51.6  \\
           & 42.8  &  50.5  &  48.4  \\
\hline A_3 & 60.1  &  70.9  &  39.2  \\
           & 58.3  &  73.2  &  40.7  \\
\hline A_4 & 75.8  &  58.2  &  48.7  \\
           & 71.5  & 51 &  41.4 \\
\hline
\end{array}
$$

```{r}
x <- c(
    58.2, 56.2, 65.3, 52.6, 41.2, 60.8,
    49.1, 54.1, 51.6, 42.8, 50.5, 48.4,
    60.1, 70.9, 39.2, 58.3, 73.2, 40.7,
    75.8, 58.2, 48.7, 71.5, 51, 41.4
)
A <- gl(4, 6)
B <- gl(3, 1, 24)
fit <- aov(x ~ A + B + A:B)
summary(fit)
```

### 实验4

某5个不同地点、不同时间空气中的颗粒状物（以$mg/m^3$计）的含量的数据如表所示

$$
\begin{array}{|c|r|r|r|r|r|}
\hline \text { 时间 \\ 地点 } & \text { 地点1 } & \text { 地点2 } & \text { 地点3 } & \text { 地点4 } & \text { 地点5 } \\
\hline \text { 1975年10月 } & 76 & 67 & 81 & 56 & 51 \\
\hline \text { 1976年1月 } & 82 & 69 & 96 & 59 & 70 \\
\hline \text { 1976年5月 } & 68 & 59 & 67 & 54 & 42 \\
\hline \text { 1996年8月 } & 63 & 56 & 64 & 58 & 37 \\
\hline
\end{array}
$$

假设本题符合双因素无重复试验方差分析的条件，试在显著性水平$\alpha=0.05$下检验；在不同时间下颗粒状物含量的均值有无显著差异?在不同地点下颗粒状物含量的均值有无显著差异?

```{r}
x <- c(
    76, 67, 81, 56, 51,
    82, 69, 96, 59, 70,
    68, 59, 67, 54, 42,
    63, 56, 64, 58, 37
)
A <- gl(4, 5)
B <- gl(5, 4)
fit <- aov(x ~ A + B + A:B)
summary(fit)
fitA=aov(x~A)
pairwise.t.test(x,A)
plotmeans(x~A, xlab="x",ylab="time",p=0.95)
boxplot(x~A)
firB=aov(x~B)
pairwise.t.test(x,B)
plotmeans(x~B, xlab="x",ylab="places",p=0.95)
boxplot(x~B)
```

### 实验5

将抗生素注入人体会产生抗生素与血浆蛋白质结合的现象,以致减少了药效.下表中列出了5种常用的抗生素注入到牛的体内时,抗生素与血浆蛋白质结合的百分比.试在水平$\alpha=0.05$下检验这些百分比的均值有无显著的差异.

$$
\begin{array}{ccccc}
\hline 青霉素 & 四环素 & 链霉素 & 红霉素 & 氯霉素 \\
\hline 29.6 & 27.3 & 5.8 & 21.6 & 29.2 \\
24.3 & 32.6 & 6.2 & 17.4 & 32.8 \\
28.5 & 30.8 & 11.0 & 18.3 & 25.0 \\
32.0 & 34.8 & 8.3 & 19.0 & 24.2 \\
\end{array}
$$

```{r}
x <- c(
    29.6, 27.3, 5.8, 21.6, 29.2,
    24.3, 32.6, 6.2, 17.4, 32.8,
    28.5, 30.8, 11.0, 18.3, 25.0,
    32.0, 34.8, 8.3, 19.0, 24.2
)
A <- gl(5, 1, 20)
fit <- aov(x ~ A)
summary(fit)

# 多重比较
pairwise.t.test(x,B)
```

## 实验小结

通过此次实验我了解了使用R进行方差的方法和流程，对方差分析有了更深入的认识，学习到很多教材上没有涉及的内容。